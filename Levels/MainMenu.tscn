[gd_scene load_steps=16 format=2]

[ext_resource path="res://Objects/Button/Button.tscn" type="PackedScene" id=1]
[ext_resource path="res://assets/Fonts/zorque.ttf" type="DynamicFontData" id=2]
[ext_resource path="res://Objects/Button/LabelButton.tscn" type="PackedScene" id=3]
[ext_resource path="res://assets/Background/Level01/fon.png" type="Texture" id=4]
[ext_resource path="res://assets/Background/Level01/field3.png" type="Texture" id=5]
[ext_resource path="res://assets/Background/Level01/mount2.png" type="Texture" id=6]
[ext_resource path="res://assets/Music/Main_menu.ogg" type="AudioStream" id=7]
[ext_resource path="res://Objects/UI/Adjuster.tscn" type="PackedScene" id=8]

[sub_resource type="GDScript" id=1]
script/source = "extends Node2D

var t : Tween

func _ready():
	call_deferred(\"setup\")
	if G.game_just_started:
		call_deferred(\"load_game\")
	else:
		save_game()
	
func setup():
	t = get_node(\"Tween\")
	
	# Wait for game loading
	if G.game_just_started:
		yield(G.gameData, \"game_loaded\")
		G.game_just_started = false
	
	# Menus buttons
	$Pos_MMenu/BPlay.connect(\"pressed\", self, \"move_to\", [$Pos_Play])
	$Pos_MMenu/BUpgrades.connect(\"pressed\", self, \"move_to\", [$Pos_Upgrades])
	$Pos_MMenu/BOptions.connect(\"pressed\", self, \"move_to\", [$Pos_Options])
	
	# Back button
	$canvas/Back.connect(\"pressed\", self, \"move_to\", [$Pos_MMenu])
	
	# Levels
	$Pos_Play/Level1.connect(\"pressed\", self, \"level\", [1])
	$Pos_Play/Level2.connect(\"pressed\", self, \"level\", [2])
	$Pos_Play/Level3.connect(\"pressed\", self, \"level\", [3])
	$Pos_Play/Level4.connect(\"pressed\", self, \"level\", [4])
	$Pos_Play/Level5.connect(\"pressed\", self, \"level\", [5])
	
	# Scroll animation
	$canvas/bg/scroller.play(\"Scroll\")
	
	# Show score
	$canvas/Score.text = str(G.gameData.get_coins())
	
	# Volume Control
	$Pos_Options/A_MusicVolume.set_value(G.gameData.get_music_volume() * 10)
	$Pos_Options/A_SoundVolume.set_value(G.gameData.get_sound_volume() * 10)
	$Pos_Options/A_MusicVolume.connect(\"value_changed\", self, \"_mus_vol\")
	$Pos_Options/A_SoundVolume.connect(\"value_changed\", self, \"_snd_vol\")
	G.gameData.emit_signal(\"music_volume_changed\", G.gameData.get_music_volume())
	G.gameData.emit_signal(\"sound_volume_changed\", G.gameData.get_sound_volume())

func move_to(node):
	if !t.is_active():
		var pos1 = $Camera.global_position
		var pos2 = node.global_position
		if node.has_node(\"NoBack\"):
			$canvas/Back.visible = false
		else:
			$canvas/Back.visible = true
		t.interpolate_property($Camera, \"position\", pos1, pos2, .3)
		t.start()

func level(n):
	G.gameData.save_game()
	get_tree().change_scene(\"res://Levels/Level0\" + str(n) + \".tscn\")

func load_game():
	G.gameData.load_game()

func save_game():
	G.gameData.save_game()

func _mus_vol(n):
	var nn = float(n) / 10
	G.gameData.set_music_volume(nn)

func _snd_vol(n):
	var nn = float(n) / 10
	G.play(\"blow.ogg\")
	G.gameData.set_sound_volume(nn)
"

[sub_resource type="GDScript" id=2]
script/source = "extends AudioStreamPlayer

func _ready():
	G.gameData.connect(\"music_volume_changed\", self, \"_vol\")
	_vol(G.gameData.get_music_volume())

func _vol(n):
	volume_db = -25 + (30 * n)
"

[sub_resource type="GDScript" id=3]
script/source = "extends AudioStreamPlayer

func _ready():
	G.connect(\"sound_play\", self, \"_play\")
	
func _play(name):
	if playing:
		stop()
	stream = load(\"res://assets/sound/\" + name)
	volume_db = -15 + (20 * G.gameData.get_sound_volume())
	play()
"

[sub_resource type="DynamicFont" id=4]
size = 24
font_data = ExtResource( 2 )

[sub_resource type="GDScript" id=5]
script/source = "extends Label

var _timer

func _ready():
	_timer = Timer.new()
	_timer.one_shot = false
	_timer.wait_time = 1
	_timer.connect(\"timeout\", self, \"_coins\")
	add_child(_timer)
	_timer.start()

func _coins():
	text = str(G.gameData.get_coins())
"

[sub_resource type="Animation" id=6]
length = 30.0
tracks/0/type = "value"
tracks/0/path = NodePath("mountains:position")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/keys = {
"times": PoolRealArray( 0, 15, 29.9 ),
"transitions": PoolRealArray( 1, 1.10957, 1 ),
"update": 0,
"values": [ Vector2( 0, 0 ), Vector2( -800, 0 ), Vector2( 0, 0 ) ]
}

[sub_resource type="GDScript" id=7]
script/source = "extends Timer

func _timeout():
	G.gameData.save_game()
"

[node name="Node2D" type="Node2D"]
script = SubResource( 1 )

[node name="Camera" type="Camera2D" parent="."]
offset = Vector2( 200, 150 )
current = true

[node name="Tween" type="Tween" parent="."]

[node name="MainSound" type="AudioStreamPlayer" parent="."]
stream = ExtResource( 7 )
autoplay = true
script = SubResource( 2 )

[node name="Audio" type="AudioStreamPlayer" parent="."]
script = SubResource( 3 )

[node name="Pos_MMenu" type="Node2D" parent="."]

[node name="NoBack" type="Label" parent="Pos_MMenu"]
margin_left = 36.8143
margin_top = 54.6158
margin_right = 365.814
margin_bottom = 83.6158
custom_fonts/font = SubResource( 4 )
text = "Balloon Cat - THe game"
__meta__ = {
"_edit_lock_": true,
"_edit_use_anchors_": false
}

[node name="BPlay" parent="Pos_MMenu" instance=ExtResource( 1 )]
position = Vector2( 43.7001, 172.5 )
scale = Vector2( 4.05197, 4.4532 )

[node name="BUpgrades" parent="Pos_MMenu" instance=ExtResource( 1 )]
position = Vector2( 168.05, 203.8 )
scale = Vector2( 4.05197, 4.4532 )

[node name="BOptions" parent="Pos_MMenu" instance=ExtResource( 1 )]
position = Vector2( 278.8, 172.5 )
scale = Vector2( 4.05197, 4.4532 )

[node name="up" type="Label" parent="Pos_MMenu"]
margin_left = 193.0
margin_top = 229.0
margin_right = 230.0
margin_bottom = 258.0
custom_fonts/font = SubResource( 4 )
text = "Up"
__meta__ = {
"_edit_use_anchors_": false
}

[node name="play" type="Label" parent="Pos_MMenu"]
margin_left = 56.0
margin_top = 198.0
margin_right = 117.0
margin_bottom = 227.0
custom_fonts/font = SubResource( 4 )
text = "PLAY"
__meta__ = {
"_edit_use_anchors_": false
}

[node name="opt" type="Label" parent="Pos_MMenu"]
margin_left = 297.871
margin_top = 202.513
margin_right = 358.871
margin_bottom = 231.513
custom_fonts/font = SubResource( 4 )
text = "OPT"
__meta__ = {
"_edit_use_anchors_": false
}

[node name="Pos_Play" type="Node2D" parent="."]
position = Vector2( 816.958, 1.80501 )

[node name="Level1" parent="Pos_Play" instance=ExtResource( 3 )]
position = Vector2( 50, 50 )
label = "1"

[node name="Level2" parent="Pos_Play" instance=ExtResource( 3 )]
position = Vector2( 150, 50 )
label = "2"

[node name="Level3" parent="Pos_Play" instance=ExtResource( 3 )]
position = Vector2( 250, 50 )
label = "3"

[node name="Level4" parent="Pos_Play" instance=ExtResource( 3 )]
position = Vector2( 50, 150 )
label = "4"

[node name="Level5" parent="Pos_Play" instance=ExtResource( 3 )]
position = Vector2( 150, 150 )
label = "5"

[node name="Label" type="Label" parent="Pos_Play"]
margin_left = 60.609
margin_top = 247.988
margin_right = 312.609
margin_bottom = 276.988
custom_fonts/font = SubResource( 4 )
text = "choose your level"
__meta__ = {
"_edit_use_anchors_": false
}

[node name="Pos_Upgrades" type="Node2D" parent="."]
position = Vector2( 0, 380 )

[node name="Pos_Options" type="Node2D" parent="."]
position = Vector2( 817.445, 387.351 )

[node name="A_SoundVolume" parent="Pos_Options" instance=ExtResource( 8 )]
position = Vector2( -100, 200 )
scale = Vector2( 2, 2 )
label_text = "Sound"

[node name="A_MusicVolume" parent="Pos_Options" instance=ExtResource( 8 )]
position = Vector2( 182.555, 200 )
scale = Vector2( 2, 2 )
label_text = "Music"

[node name="canvas" type="CanvasLayer" parent="."]

[node name="Back" parent="canvas" instance=ExtResource( 1 )]
visible = false
position = Vector2( 0.950012, -0.949997 )
scale = Vector2( 2, 2 )

[node name="Score" type="Label" parent="canvas"]
margin_left = 44.16
margin_top = 3.6758
margin_right = 95.16
margin_bottom = 32.6758
custom_fonts/font = SubResource( 4 )
text = "0"
script = SubResource( 5 )
__meta__ = {
"_edit_lock_": true,
"_edit_use_anchors_": false
}

[node name="bg" type="ParallaxBackground" parent="canvas"]

[node name="bg3" type="Sprite" parent="canvas/bg"]
position = Vector2( 127.445, 198.939 )
scale = Vector2( 1.26029, 1.29889 )
texture = ExtResource( 4 )
__meta__ = {
"_edit_lock_": true
}

[node name="bg1" type="Sprite" parent="canvas/bg"]
position = Vector2( 556.51, 198.939 )
scale = Vector2( 1.26029, 1.29889 )
texture = ExtResource( 4 )
__meta__ = {
"_edit_lock_": true
}

[node name="mountains" type="Node2D" parent="canvas/bg"]

[node name="mountains" type="Sprite" parent="canvas/bg/mountains"]
position = Vector2( 257.968, 193.471 )
scale = Vector2( 2.4996, 1.34644 )
texture = ExtResource( 6 )
__meta__ = {
"_edit_lock_": true
}

[node name="mountains2" type="Sprite" parent="canvas/bg/mountains"]
position = Vector2( 1284.4, 193.471 )
scale = Vector2( 2.4996, 1.34644 )
texture = ExtResource( 6 )
__meta__ = {
"_edit_lock_": true
}

[node name="ground" type="Sprite" parent="canvas/bg"]
position = Vector2( 406.719, 198.009 )
scale = Vector2( 1.98412, 1.24785 )
texture = ExtResource( 5 )
__meta__ = {
"_edit_lock_": true
}

[node name="scroller" type="AnimationPlayer" parent="canvas/bg"]
anims/Scroll = SubResource( 6 )

[node name="AutoSaver" type="Timer" parent="."]
wait_time = 5.0
autostart = true
script = SubResource( 7 )
[connection signal="timeout" from="AutoSaver" to="AutoSaver" method="_timeout"]
